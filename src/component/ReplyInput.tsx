// This is a skeleton starter React component generated by Plasmic.
// This file is owned by you, feel free to edit as you see fit.
import * as React from 'react';
import {
  PlasmicReplyInput,
  DefaultReplyInputProps,
} from './plasmic/shared/PlasmicReplyInput';
import { useForm } from 'react-hook-form';
import { INewMessage } from 'module/interface/message';
import { useCreateMessage } from 'module/hook/message';
import { renderIntoDocument } from 'react-dom/test-utils';

type FormInputs = {
  text: string;
};

interface ReplyInputProps extends DefaultReplyInputProps {
  updateId: string;
  timelineId: string;
  organizationId: string;
  userId: string;
  reid: string;
}

function ReplyInput(props: ReplyInputProps) {
  const {
    updateId,
    timelineId,
    organizationId,
    userId,
    reid,
  } = props;

  console.log(
    'user input',
    updateId,
    timelineId,
    organizationId,
    userId,
    reid,
  );

  const { register, handleSubmit, reset } = useForm<FormInputs>();
  const { mutate: createMessage } = useCreateMessage();

  const handleAddMessage = (data: FormInputs) => {
    if (!data.text) {
      return;
    }

    const newMessage: INewMessage = {
      text: data.text,
      organizationId,
      timelineId,
      updateId,
      userId,
      reid: reid,
    };

    console.log(newMessage);

    // audienceMutation(messageId)
    createMessage(newMessage);

    //reset form
    reset({
      text: '',
    });
  };

  return (
    <PlasmicReplyInput
      replyForm={{
        onSubmit: handleSubmit(handleAddMessage),
      }}
      replyInput={{
        name: 'text',
        ref: register(),
      }}
    />
  );
}

export default ReplyInput;
