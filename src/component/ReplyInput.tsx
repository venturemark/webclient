// This is a skeleton starter React component generated by Plasmic.
// This file is owned by you, feel free to edit as you see fit.
import * as React from 'react';
import {
  PlasmicReplyInput,
  DefaultReplyInputProps,
} from './plasmic/shared/PlasmicReplyInput';
import { useForm } from 'react-hook-form';
import {
  IMessage,
  INewMessage,
  IMessageQuery,
} from 'module/interface/message';
import {
  useMessages,
  useCreateMessage,
} from 'module/hook/message';
import { subMinutes } from 'date-fns';


type FormInputs = {
  name: string;
};

interface ReplyInputProps extends DefaultReplyInputProps {
  updateId: string;
  timelineId: string;
  organizationId: string;
  userId: string;
}

function ReplyInput(props: ReplyInputProps) {
  const {updateId, timelineId, organizationId, userId} = props

  const { register, handleSubmit, reset } = useForm<FormInputs>();

  const messageSearch: IMessageQuery = {
    updateId,
    timelineId,
    userId,
    organizationId,
  };
  const { data: messagesData } = useMessages(messageSearch);
  const { mutate: createMessage } = useCreateMessage();

  const handleAddMessage = () => {
    // if (!data.name) {
    //   return;
    // }

    const newMessage: INewMessage = {
      text: 'edit message description',
      organizationId,
      timelineId,
      updateId,
      userId,
    };

    // audienceMutation(messageId)
    createMessage(newMessage);

    //reset form
    reset({
      name: '',
    });
  };

  return (
  <PlasmicReplyInput 
    replyForm={{
      onSubmit: handleSubmit(handleAddMessage),
    }}
    replyInput={{
      type: "submit",
      name: "text",
      ref: register()
    }}
  />
  )
}

export default ReplyInput;
