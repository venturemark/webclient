// This is a skeleton starter React component generated by Plasmic.
// This file is owned by you, feel free to edit as you see fit.
import * as React from "react";
import {
  PlasmicAddEditVenture,
  DefaultAddEditVentureProps,
} from "component/plasmic/shared/PlasmicAddEditVenture";
import {
  ICreateVenture,
  IVenture,
  IUpdateVenture,
} from "module/interface/venture";
import { useNavigate, useParams, useLocation } from "react-router-dom";
import { useGetToken } from "module/auth";
import { ventureNameError } from "module/errors";
import { makeVentureUrl } from "module/helpers";
import { useCreateVenture, useUpdateVenture } from "module/hook/venture";

interface AddEditVentureProps extends DefaultAddEditVentureProps {
  setIsActive: any;
  currentVenture: IVenture;
  handleSubmit: any;
  register: any;
  reset: any;
  errors: any;
}

function AddEditVenture(props: AddEditVentureProps) {
  const {
    setIsActive,
    handleSubmit,
    register,
    reset,
    errors,
    currentVenture,
    ...rest
  } = props;
  const { ventureSlug } = useParams();
  const token = useGetToken();
  const { mutate: createVenture } = useCreateVenture();
  const { mutate: updateVenture } = useUpdateVenture();

  const navigate = useNavigate();
  const venture = currentVenture;
  const url = useLocation();
  const handle = currentVenture?.name?.toLowerCase().replace(/\s/g, "");
  const ventureId = currentVenture?.id;
  const isEdit = ventureSlug && ventureSlug === handle ? "isEdit" : undefined;

  const handleCreate = (data: any) => {
    const createHandle = data.ventureName.toLowerCase().replace(/\s/g, "");
    const ventureCreate: ICreateVenture = {
      name: data.ventureName,
      desc: data.ventureDescription,
      url: makeVentureUrl(createHandle),
      successUrl: `/${createHandle}/newtimeline`,
      token: token,
    };
    const ventureUpdate: IUpdateVenture = {
      id: ventureId,
      name: data.ventureName,
      desc: data.ventureDescription,
      url: makeVentureUrl(handle),
      successUrl: `/${handle}`,
      token: token,
    };

    console.log(data);

    // isEdit ? updateVenture(ventureUpdate) : createVenture(ventureCreate);
    // reset();
  };

  return (
    <PlasmicAddEditVenture
      {...rest}
      variantState={isEdit}
      settings={{
        onSubmit: handleSubmit(handleCreate),
      }}
      name={{
        register: register({ required: true, maxLength: 23 }),
        name: "ventureName",
        defaultValue:
          url?.pathname === "/newventure" ? "" : venture?.name ?? "",
        errorMessage: errors.name && ventureNameError,
      }}
      description={{
        register: register(),
        name: "ventureDescription",
        defaultValue:
          url?.pathname === "/newventure" ? "" : venture?.desc ?? "",
      }}
      url={{
        register: register(),
        name: "url",
        defaultValue: venture?.url ?? "",
      }}
      membersWrite={{ variantSettings: ["isDisabled", "hasLabel"] }}
      buttons={{
        handleDelete: () =>
          navigate(`/${handle}/delete?ventureId=${ventureId}`),
        handleCancel: () => navigate(-1),
        handleSave: () => handleSubmit(handleCreate),
      }}
    />
  );
}

export default AddEditVenture;
