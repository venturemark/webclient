// This is a skeleton starter React component generated by Plasmic.
// This file is owned by you, feel free to edit as you see fit.
import React from "react";
import {
  PlasmicMain,
  DefaultMainProps,
} from "component/plasmic/shared/PlasmicMain";
import { ITimeline, ISearchTimeline } from "module/interface/timeline";
import { useTimelines } from "module/hook/timeline";
import { useParams } from "react-router-dom";
import { useForm } from "react-hook-form";
import { useGetToken } from "module/auth";
import { IVenture } from "module/interface/venture";
import { IUser } from "module/interface/user";

interface ParamTypes {
  ventureSlug: string;
  timelineSlug: string;
}

interface MainProps extends DefaultMainProps {
  isOnboarding?: boolean | "isOnboarding";
  isActive: any;
  variantType: any;
  setIsVisible: any;
  setPost: any;
  viewCreateVenture?: any;
  viewJoinVenture?: any;
  ventureId: string;
  currentVenture: IVenture;
  user: IUser;
}

function Main(props: MainProps) {
  const {
    isOnboarding,
    isActive,
    variantType,
    setIsVisible,
    setPost,
    viewCreateVenture,
    viewJoinVenture,
    ventureId,
    currentVenture,
    user,
    ...rest
  } = props;
  const token = useGetToken();
  const { handleSubmit, register, reset, watch, errors } = useForm();
  const watchData = watch();
  const { timelineSlug } = useParams<ParamTypes>();

  const timelineSearch: ISearchTimeline = {
    ventureId: ventureId,
    token,
  };

  const { data: timelinesData } = useTimelines(timelineSearch);

  const timelines = timelinesData ?? [];
  const currentTimeline = timelines.filter((timeline: ITimeline) => {
    return (
      timeline.name.toLowerCase().replace(/\s/g, "") ===
        timelineSlug?.toLowerCase().replace(/\s/g, "") ?? ""
    );
  })[0];

  return (
    <PlasmicMain
      {...rest}
      isActive={isActive}
      variantType={variantType}
      mainHeader={{
        isActive,
        variantType,
        currentTimeline,
        watchData,
        isOnboarding,
        currentVenture,
      }}
      feedUpdate={{
        setIsVisible,
        timelines,
        currentTimeline,
        currentVenture,
        setPost,
        user,
      }}
      addEditMembers={{
        currentVenture,
        currentTimeline,
      }}
      addEditVenture={{
        currentVenture,
        handleSubmit,
        register,
        reset,
        errors,
      }}
      addEditTimeline={{
        currentVenture,
        currentTimeline,
        setIsVisible,
        handleSubmit,
        register,
        reset,
        errors,
      }}
      viewCreateVenture={{
        onClick: () => viewCreateVenture(),
      }}
      viewJoinVenture={{ onClick: () => viewJoinVenture }}
    />
  );
}

export default Main;
