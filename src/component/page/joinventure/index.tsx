// This is a skeleton starter React component generated by Plasmic.
// This file is owned by you, feel free to edit as you see fit.
import React, { useContext, useState } from "react";

import { UserContext } from "component/app";
import {
  DefaultJoinVentureProps,
  PlasmicJoinVenture,
} from "component/plasmic/shared/PlasmicJoinVenture";
import { useGetToken } from "module/auth";
import { useUpdateInvite } from "module/hook/invite";
import { IUpdateInvite } from "module/interface/invite";

type IsVisible = "postDetails" | "mobileSidebar" | "showModal";

interface JoinVentureProps extends DefaultJoinVentureProps {
  isVisible?: IsVisible;
}

function JoinVenture(props: JoinVentureProps) {
  const { mutate: updateInvite } = useUpdateInvite();
  const token = useGetToken();
  const ventureName = localStorage.getItem("ventureName");

  const handleAcceptJoin = () => {
    const ventureId = localStorage.getItem("ventureId");
    const timelineId = localStorage.getItem("timelineId");
    const code = localStorage.getItem("code");
    const id = localStorage.getItem("id");
    const resource = localStorage.getItem("resource");
    const role = localStorage.getItem("role");

    const inviteUpdate: IUpdateInvite = {
      id: id ?? "",
      ventureId: ventureId ?? "",
      timelineId: timelineId ?? "",
      code: code ?? "",
      resource: resource ?? "",
      role: role ?? "",
      successUrl: "/",
      status: "accepted",
      token,
    };

    updateInvite(inviteUpdate);
  };

  const userContext = useContext(UserContext);
  const user = userContext?.user;

  // local hooks shared with page-level elements
  const [isVisible, setIsVisible] = useState<IsVisible | undefined>(
    props.isVisible
  );

  return (
    <PlasmicJoinVenture
      header={{
        isVisible,
        setIsVisible,
        user,
      }}
      ventureName={ventureName}
      viewCreateVenture={{ onPress: () => handleAcceptJoin() }}
    />
  );
}

export default JoinVenture;
