// This is a skeleton starter React component generated by Plasmic.
// This file is owned by you, feel free to edit as you see fit.
import React, { useContext, useState } from "react";
import {
  PlasmicReplyContent,
  DefaultReplyContentProps,
} from "component/plasmic/shared/PlasmicReplyContent";
import { IUser } from "module/interface/user";
import { UserContext } from "component/app";
import { useDeleteMessage } from "module/hook/message";
import { IDeleteMessage } from "module/interface/message";
import { useGetToken } from "module/auth";

interface ReplyContentProps extends DefaultReplyContentProps {
  id: string;
  updateId: string;
  timelineId: string;
  ventureId: string;
  userName?: string;
  text: string;
  date: string;
  user?: IUser;
}

function ReplyContent(props: ReplyContentProps) {
  const {
    userName,
    date,
    text,
    user,
    id,
    timelineId,
    ventureId,
    updateId,
    ...rest
  } = props;
  const token = useGetToken();

  const { mutate: deleteMessage } = useDeleteMessage();
  const userContext = useContext(UserContext);
  const [showMenu, setShowMenu] = useState(false);

  const isOwner = user?.id === userContext?.user.id ? "isUser" : undefined;

  const handleDeleteMessage = () => {
    const messageDelete: IDeleteMessage = {
      id,
      timelineId,
      updateId,
      ventureId,
      token: token,
    };

    deleteMessage(messageDelete);
  };

  return (
    <PlasmicReplyContent
      {...rest}
      state={isOwner}
      iconMenu={{
        onClick: () => setShowMenu(!showMenu),
      }}
      isUserOnClick={showMenu}
      dropdown={{
        handleClick: () => {
          handleDeleteMessage();
        },
      }}
      userName={userName}
      text={text}
      date={date}
      photoAvatar={{
        user,
      }}
    />
  );
}

export default ReplyContent;
