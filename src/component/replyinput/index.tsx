// This is a skeleton starter React component generated by Plasmic.
// This file is owned by you, feel free to edit as you see fit.
import React from "react";
import {
  PlasmicReplyInput,
  DefaultReplyInputProps,
} from "component/plasmic/shared/PlasmicReplyInput";
import { useForm } from "react-hook-form";
import { ICreateMessage } from "module/interface/message";
import { useCreateMessage } from "module/hook/message";
import { useGetToken } from "module/auth";

type FormInputs = {
  text: string;
};

interface ReplyInputProps extends DefaultReplyInputProps {
  updateId: string;
  timelineId: string;
  ventureId: string;
}

function ReplyInput(props: ReplyInputProps) {
  const { updateId, timelineId, ventureId } = props;
  const token = useGetToken();

  const { register, handleSubmit, reset } = useForm<FormInputs>();
  const { mutate: createMessage } = useCreateMessage();

  const handleAddMessage = (data: FormInputs) => {
    if (!data.text) {
      return;
    }

    const newMessage: ICreateMessage = {
      text: data.text,
      ventureId,
      timelineId,
      updateId,
      token,
    };

    console.log(newMessage);
    createMessage(newMessage);

    //reset form
    reset();
  };

  return (
    <PlasmicReplyInput
      replyForm={{
        onSubmit: handleSubmit(handleAddMessage),
      }}
      replyInput={{
        name: "text",
        ref: register(),
      }}
      postReplyButton={{
        type: "submit",
      }}
    />
  );
}

export default ReplyInput;
