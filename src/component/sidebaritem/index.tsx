// This is a skeleton starter React component generated by Plasmic.
// This file is owned by you, feel free to edit as you see fit.
import React, { useState, useEffect } from "react";
import {
  PlasmicSidebarItem,
  DefaultSidebarItemProps,
} from "component/plasmic/shared/PlasmicSidebarItem";
import { useHistory } from "react-router-dom";
import { getVenture } from "module/store";

interface SidebarItemProps extends DefaultSidebarItemProps {
  name: string;
  userId: string;
  organizationId: string;
  setHasInput?: any;
  itemType?: "timeline" | "createTimeline" | "ventureCollapsed";
}
function SidebarItem(props: SidebarItemProps) {
  const {
    name,
    userId,
    organizationId,
    itemType,
    setHasInput,
    ...rest
  } = props;
  const [isUserOnClick, setIsUserOnClick] = useState(false);
  const history = useHistory();
  const venture = getVenture();
  const timelineSlug = name.toLowerCase().replace(/\s/g, "");

  const link =
    itemType === "timeline"
      ? `/${venture?.id}/${timelineSlug}`
      : `/${venture?.id}`;

  useEffect(() => {
    const handleWindowClick = () => setIsUserOnClick(false);
    if (isUserOnClick) {
      window.addEventListener("click", handleWindowClick);
      window.addEventListener("keydown", handleWindowClick);
    } else {
      window.removeEventListener("click", handleWindowClick);
      window.removeEventListener("keydown", handleWindowClick);
    }
    return () => {
      window.removeEventListener("click", handleWindowClick);
      window.removeEventListener("keydown", handleWindowClick);
    };
  }, [isUserOnClick, setIsUserOnClick]);

  return (
    <PlasmicSidebarItem
      isUserOnClick={isUserOnClick}
      icon={{
        onClick: (e) => {
          e.stopPropagation();
        },
      }}
      iconButton={{
        onClick: (event) => {
          event.stopPropagation();
          setIsUserOnClick(!isUserOnClick);
        },
      }}
      onClick={() => history.push(link)}
      itemType={itemType}
      name={name}
      {...rest}
    />
  );
}

export default SidebarItem;
