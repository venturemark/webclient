// This is a skeleton starter React component generated by Plasmic.
// This file is owned by you, feel free to edit as you see fit.
import React from "react";
import {
  PlasmicUpdate,
  DefaultUpdateProps,
} from "component/plasmic/shared/PlasmicUpdate";
import { Node } from "slate";
import * as linechart from "component/linechart";
import { TimelineType } from "component/home";

export interface UpdateType {
  id: string;
  text: Node[];
  numberValue: number;
  isFlipped: boolean;
}

interface UpdateProps extends DefaultUpdateProps {
  text: Node[];
  dataKey: string;
  data: linechart.DataItem[];
  name: string;
  isFlipped: boolean;
  timelines: TimelineType[];
  setTimelines: React.Dispatch<React.SetStateAction<TimelineType[]>>;
  id: string;
}

function Update(props: UpdateProps) {
  const {
    text,
    dataKey,
    data,
    name,
    isFlipped,
    timelines,
    setTimelines,
    id,
  } = props;

  return (
    <PlasmicUpdate
      toggleUpdateView={{
        "aria-label": "Toggle View",
        onPress: () => {
          const flippedTimelines = timelines.map((timeline) => {
            if (timeline.isCurrent) {
              const flippedUpdates = timeline.updates.map((update) => {
                const isFlipped = id === update.id ? !update.isFlipped : false;
                return { ...update, isFlipped };
              });

              return { ...timeline, updates: flippedUpdates };
            } else {
              return timeline;
            }
          });
          setTimelines(flippedTimelines);
        },
      }}
      updateContent={{
        isFlipped: isFlipped,
        text: text,
        name: name,
        dataKey: dataKey,
        data: data,
      }}
    />
  );
}

export default Update;
